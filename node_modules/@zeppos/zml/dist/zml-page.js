let e=null;function t(){return o()&&n()}function i(){return o()&&s()}function n(){return"undefined"!=typeof hmApp}function s(){return"undefined"!=typeof __$$R$$__}function o(){return n()||s()}e="undefined"!=typeof __$$R$$__?__$$R$$__:()=>{},t()?hmApp.getPackageInfo:i()&&e("@zos/app").getPackageInfo,t()?hmUI:i()&&e("@zos/ui"),t()?hmSetting.getDeviceInfo:i()&&e("@zos/device").getDeviceInfo,t()?"undefined"!=typeof __$$app$$__&&__$$app$$__:i()&&e("@zos/i18n").getText,t()?hmApp.gotoPage:i()&&e("@zos/router").push,t()?hmBle:i()&&e("@zos/ble");let l=null;t()?l=DeviceRuntimeCore.HmLogger:i()?l=e("@zos/utils").log:"undefined"!=typeof messaging&&"undefined"!=typeof Logger&&(l=Logger),e("@zos/utils").EventBus,e("@zos/timer").setTimeout,e("@zos/timer").clearTimeout,o()?l.getLogger("device-message"):l.getLogger("side-message"),l.getLogger("message-builder");const r=e("@zos/ble/TransferFile"),a=(h=new r,{onFile(e){return e?(void 0===h||h.inbox.on("newfile",(function(){const t=h.inbox.getNextFile();e&&e(t)})),this):this},onSideServiceFileFinished(e){return e?(void 0===h||h.inbox.on("file",(function(){const t=h.inbox.getNextFile();e&&e(t)})),this):this},emitFile(){return h.inbox.emit("file"),this},offFile(){return void 0===h||(h.inbox.off("newfile"),h.inbox.off("file")),this},getFile:()=>void 0===h?null:h.inbox.getNextFile(),sendFile(e,t){if(void 0===h)throw new Error("fileTransfer is not available");return h.outbox.enqueueFile(e,t)}});var h;const u=Object.prototype.hasOwnProperty;function g(e,t){return Object.getOwnPropertyNames(t).forEach((function(i){if(!u.call(e,i)){var n=Object.getOwnPropertyDescriptor(t,i);Object.defineProperty(e,i,n)}})),e}function f({state:e={},onInit:t,onResume:i,onPause:n,build:s,onDestroy:o,...l}={}){const r=function(){const{messaging:e}=getApp()._options.globalData;return e}(),h={state:e,...l,globalData:getApp()._options.globalData,onInit(...e){this._onCall=this.onCall?.bind(this),this._onRequest=this.onRequest?.bind(this),this.messaging=r,this.messaging.onCall(this._onCall).onRequest(this._onRequest),this.onReceivedFile&&(this._onReceivedFile=this.onReceivedFile?.bind(this),a.onFile(this._onReceivedFile));for(let t=0;t<=f.mixins.length-1;t++){const i=f.mixins[t];i.handler.onInit?.apply(this,e)}t?.apply(this,e)},onResume(...e){for(let t=0;t<=f.mixins.length-1;t++){const i=f.mixins[t];i.handler.onResume?.apply(this,e)}i?.apply(this,e)},onPause(...e){n?.apply(this,e);for(let t=f.mixins.length-1;t>=0;t--){const i=f.mixins[t];i.handler.onPause?.apply(this,e)}},build(...e){for(let t=0;t<=f.mixins.length-1;t++){const i=f.mixins[t];i.handler.build?.apply(this,e)}s?.apply(this,e)},onDestroy(...e){o?.apply(this,e);for(let t=f.mixins.length-1;t>=0;t--){const i=f.mixins[t];i.handler.onDestroy?.apply(this,e)}this._onCall&&this.messaging.offOnCall(this._onCall),this._onRequest&&this.messaging.offOnRequest(this._onRequest),this._onReceivedFile&&a.offFile(this._onReceivedFile)},request(e,t={}){return this.messaging.request(e,t)},call(e){return this.messaging.call(e)},sendFile:(e,t)=>a.sendFile(e,t)};return f.handle(h),h}g(f,{init(){this.plugins=[],this.settings={},this.mixins=[]},set(e,t){if(1===arguments.length)return this.settings[e];this.settings[e]=t},use(e,...t){return"function"==typeof e?this.plugins.push({handler:e,args:t}):"object"==typeof e&&this.mixins.push({handler:e,args:[]}),this},handle(e){this.plugins.forEach((t=>{t&&"function"==typeof t.handler&&t.handler.call(this,e,...t.args)})),this.mixins.forEach((({handler:{onInit:t,onPause:i,build:n,onResume:s,onDestroy:o,onCreate:l,...r},args:a})=>{Object.assign(e,r)}))}}),f.init(),f.use((function(e){e.httpRequest=function(e,t={}){return this.messaging.request({method:"http.request",params:e},t)}}));export{f as BasePage,g as merge};
